import streamlit as st
import requests

# ×”×’×“×¨×•×ª ×“×£ ×‘×¡×™×¡×™×•×ª
st.set_page_config(page_title="××—×©×‘×•×Ÿ ××˜×‘×¢ DK", page_icon="ğŸ‡»ğŸ‡³", layout="centered")

# --- ×—×œ×§ 1: ×¢×™×¦×•×‘ ×”×œ×•×’×• DK ×•×”×›×¤×ª×•×¨ (CSS) ---
st.markdown(
    """
    <style>
    .main {
        direction: rtl;
    }
    .logo-wrapper {
        display: flex;
        justify-content: center;
        margin-bottom: 10px;
    }
    .logo-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 90px;
        height: 90px;
        background-color: #2E7D32;
        border-radius: 50%;
        color: white;
        font-family: 'Arial Black', sans-serif;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        border: 2px solid #ffffff;
    }
    .logo-text {
        font-size: 34px;
        line-height: 1;
        font-weight: bold;
    }
    .logo-lines {
        width: 35px;
        height: 2px;
        background: white;
        margin-top: 5px;
        box-shadow: 0 4px 0 white; /* ×§×• ×©× ×™ */
    }
    .pay-btn {
        background-color: #FFDD00;
        color: black !important;
        padding: 12px 24px;
        border-radius: 12px;
        text-decoration: none;
        font-weight: bold;
        display: inline-block;
        font-size: 18px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .pay-btn:hover {
        background-color: #ffd000;
        transform: scale(1.05);
        transition: 0.2s;
    }
    </style>
    <div class="logo-wrapper">
        <div class="logo-container">
            <span class="logo-text">DK</span>
            <div class="logo-lines"></div>
        </div>
    </div>
    """,
    unsafe_allow_html=True
)

# --- ×—×œ×§ 2: ×¤×•× ×§×¦×™×” ×œ××©×™×›×ª ×©×¢×¨×™× ×‘×–××Ÿ ×××ª ---
def get_live_rates():
    try:
        # API ×—×™× ××™ ×•×™×¦×™×‘ ×œ×©×¢×¨×™ ×—×œ×™×¤×™×Ÿ
        url = "https://open.er-api.com/v6/latest/USD"
        response = requests.get(url, timeout=5)
        data = response.json()
        
        usd_to_vnd = data['rates']['VND']
        usd_to_ils = data['rates']['ILS']
        
        # ×—×™×©×•×‘ ×©×§×œ ×œ×“×•× ×’
        ils_to_vnd = usd_to_vnd / usd_to_ils
        
        return ils_to_vnd, usd_to_vnd, True
    except:
        # ×©×¢×¨×™× ×œ××§×¨×” ×©××™×Ÿ ××™× ×˜×¨× ×˜ (×¢×¨×›×™ ×’×™×‘×•×™)
        return 6800.0, 25000.0, False

# ××©×™×›×ª ×”× ×ª×•× ×™×
ils_to_vnd_rate, usd_to_vnd_rate, is_live = get_live_rates()

# --- ×—×œ×§ 3: ×›×•×ª×¨×ª ×•×××©×§ ×”××—×©×‘×•×Ÿ ---
st.markdown("<h1 style='text-align: center;'>××—×©×‘×•×Ÿ ××˜×‘×¢ ×œ×˜×™×•×œ ğŸ‡»ğŸ‡³</h1>", unsafe_allow_html=True)
st.markdown("<p style='text-align: center;'>×”×•×¤×›×™× ××™×œ×™×•× ×™× ×œ×©×§×œ×™× ×‘×¨×’×¢</p>", unsafe_allow_html=True)

if is_live:
    st.caption("âœ… ×©×¢×¨×™× ××¢×•×“×›× ×™× ×‘×–××Ÿ ×××ª ××”×¨×©×ª")
else:
    st.caption("âš ï¸ ××¦×‘ ××•×¤×œ×™×™×Ÿ: ××©×ª××© ×‘×©×¢×¨×™ ×’×™×‘×•×™")

st.divider()

# ×‘×—×™×¨×ª ××˜×‘×¢ ×•×¡×›×•×
option = st.selectbox("××™×–×” ××˜×‘×¢ ×‘×¨×¦×•× ×š ×œ×”××™×¨?", ["×“×•× ×’ (VND)", "×©×§×œ (ILS)", "×“×•×œ×¨ (USD)"])

# ×”×’×“×¨×ª ×¡×›×•× ×‘×¨×™×¨×ª ××—×“×œ × ×•×— ×œ×¤×™ ×¡×•×’ ×”××˜×‘×¢
default_val = 100000.0 if option == "×“×•× ×’ (VND)" else 1.0
amount = st.number_input("×”×›× ×™×¡×™ ×¡×›×•×:", min_value=0.0, value=default_val, step=1.0)

st.divider()

# ×œ×•×’×™×§×ª ×”×—×™×©×•×‘ ×•×”×¦×’×”
if option == "×“×•× ×’ (VND)":
    ils = amount / ils_to_vnd_rate
    usd = amount / usd_to_vnd_rate
    st.metric("×‘×©×§×œ×™× (ILS)", f"â‚ª{ils:.2f}")
    st.metric("×‘×“×•×œ×¨ (USD)", f"${usd:.2f}")

elif option == "×©×§×œ (ILS)":
    vnd = amount * ils_to_vnd_rate
    usd = amount / (usd_to_vnd_rate / ils_to_vnd_rate)
    st.metric("×‘×•×•×™×™×˜× ×××™ (VND)", f"{vnd:,.0f} â‚«")
    st.metric("×‘×“×•×œ×¨ (USD)", f"${usd:.2f}")

elif option == "×“×•×œ×¨ (USD)":
    vnd = amount * usd_to_vnd_rate
    ils = amount * (usd_to_vnd_rate / ils_to_vnd_rate)
    st.metric("×‘×•×•×™×™×˜× ×××™ (VND)", f"{vnd:,.0f} â‚«")
    st.metric("×‘×©×§×œ×™× (ILS)", f"â‚ª{ils:.2f}")

# ×”×¦×’×ª ×©×¢×¨×™ ×”×”××¨×” ×œ×‘×™×§×•×¨×ª ×‘×ª×—×ª×™×ª
with st.expander("×¤×¨×˜×™ ×©×¢×¨×™ ×”×—×œ×™×¤×™×Ÿ"):
    st.write(f"1 â‚ª = {ils_to_vnd_rate:,.2f} VND")
    st.write(f"1 $ = {usd_to_vnd_rate:,.2f} VND")

# --- ×—×œ×§ 4: ×›×¤×ª×•×¨ ×¤×¨×’×•×Ÿ (Buy Me a Coffee) ---
st.divider()
st.markdown("<div style='text-align: center;'>", unsafe_allow_html=True)
st.write("× ×”× ×™×ª× ××”××—×©×‘×•×Ÿ? ×¢×–×¨ ×œ×›× ×‘×©×•×§, ×‘××•× ×™×ª ××• ×‘××¡×¢×“×”? ğŸœğŸš•")

# ×›××Ÿ ×ª×“×‘×™×§×™ ××ª ×”×œ×™× ×§ ×©×ª×§×‘×œ×™ ×-Buy Me a Coffee
pay_link = "https://www.buymeacoffee.com/yourname" 

st.markdown(f'<a href="{pay_link}" target="_blank" class="pay-btn">â˜• ×¤×¨×’× ×• ×œ×™ ×‘×§×¤×” ×‘×•×•×™×™×˜× ×× (1$)</a>', unsafe_allow_html=True)
st.markdown("<p style='margin-top:15px; font-size: 12px;'>×¤×•×ª×— ×‘××”×‘×” ×¢×œ ×™×“×™ ××˜×™×™×œ×ª ×¢×‘×•×¨ ××˜×™×™×œ×™×</p>", unsafe_allow_html=True)
st.markdown("</div>", unsafe_allow_html=True)